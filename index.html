<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Msambweni TVC Full Portal</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --blue:#0d47a1;
  --yellow:#fbc02d;
}
body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:#f4f7fb;
}
header{
  background:linear-gradient(90deg,var(--blue),var(--yellow));
  color:#fff;
  padding:25px;
  text-align:center;
}
header img{height:70px}

.container{
  max-width:1100px;
  margin:40px auto;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:25px;
}
.portal{
  background:#fff;
  border-radius:18px;
  padding:25px;
  text-align:center;
  box-shadow:0 14px 30px rgba(0,0,0,.25);
}
.portal h2{color:var(--blue)}
.portal button{
  margin-top:15px;
  padding:12px 28px;
  border:none;
  border-radius:30px;
  font-weight:600;
  cursor:pointer;
  color:#fff;
}
.portal:nth-child(1) button{background:#fbc02d;color:#333}
.portal:nth-child(2) button{background:#1976d2}
.portal:nth-child(3) button{background:#2e7d32}
.portal:nth-child(4) button{background:#6a1b9a}
.portal:nth-child(5) button{background:#c62828}

/* Modal */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(13,71,161,.85);
  justify-content:center;
  align-items:center;
  z-index:100;
}
.box{
  background:#fff;
  padding:25px;
  border-radius:18px;
  width:90%;
  max-width:420px;
  text-align:center;
}
input,select{
  width:100%;
  padding:11px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
.full{
  width:100%;
  padding:12px;
  background:linear-gradient(90deg,var(--blue),var(--yellow));
  border:none;
  color:#fff;
  border-radius:25px;
  font-weight:600;
  cursor:pointer;
}
.link{
  color:var(--blue);
  cursor:pointer;
  font-size:13px;
  margin-top:8px;
}
.msg{font-size:13px;color:red}

/* Portal Content */
.portal-content{
  display:none;
  max-width:1000px;
  margin:30px auto;
  padding:25px;
  background:#fff;
  border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}
.portal-content h2{color:var(--blue)}
.logout{
  background:#9e9e9e;
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:10px;
  cursor:pointer;
}

/* Tables */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ddd;
  padding:10px;
}
th{
  background:var(--blue);
  color:#fff;
}
.download{
  background:var(--yellow);
  border:none;
  padding:8px 15px;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
<img src="files/msambweni-logo.png">
<h1>Msambweni Technical & Vocational College</h1>
<p>Integrated College Portal</p>
</header>

<!-- HOME -->
<div class="container" id="home">
  <div class="portal"><h2>üìö Library</h2><button onclick="openLogin('library')">Enter</button></div>
  <div class="portal"><h2>üíª Masomo</h2><button onclick="openLogin('masomo')">Enter</button></div>
  <div class="portal"><h2>üí∞ Finance</h2><button onclick="openLogin('finance')">Enter</button></div>
  <div class="portal"><h2>üéì Student</h2><button onclick="openLogin('student')">Enter</button></div>
  <div class="portal"><h2>üßë‚Äçüíº Admin</h2><button onclick="openLogin('admin')">Enter</button></div>
</div>

<!-- AUTH MODAL -->
<div class="modal" id="auth">
  <div class="box" id="loginBox">
    <h3>Portal Login</h3>
    <input id="luser" placeholder="Username">
    <input id="lpass" type="password" placeholder="Password">
    <button class="full" onclick="login()">Login</button>
    <div class="link" onclick="showRegister()">Create Account</div>
    <div class="link" onclick="showForgot()">Forgot Password?</div>
    <p class="msg" id="lmsg"></p>
  </div>

  <div class="box" id="regBox" style="display:none">
    <h3>Create Account</h3>
    <input id="rname" placeholder="Full Name">
    <input id="ruser" placeholder="Username">
    <input id="rpass" type="password" placeholder="Password">
    <select id="rrole">
      <option value="student">Student</option>
      <option value="lecturer">Lecturer</option>
      <option value="finance">Finance</option>
      <option value="admin">Admin</option>
    </select>
    <button class="full" onclick="register()">Register</button>
    <div class="link" onclick="showLogin()">Back</div>
    <p class="msg" id="rmsg"></p>
  </div>

  <div class="box" id="fpBox" style="display:none">
    <h3>Recover Password</h3>
    <input id="fpuser" placeholder="Username">
    <button class="full" onclick="recover()">Recover</button>
    <div class="link" onclick="showLogin()">Back</div>
    <p class="msg" id="fpmsg"></p>
  </div>
</div>

<!-- PORTAL CONTENT -->
<div id="portal" class="portal-content"></div>

<script>
const { jsPDF } = window.jspdf;

let users = JSON.parse(localStorage.getItem("users")||"[]");
if(users.length===0){
  users.push({user:"student1",pass:"123",role:"student",name:"Student One"});
  users.push({user:"admin",pass:"admin",role:"admin",name:"Admin"});
  localStorage.setItem("users",JSON.stringify(users));
}

let currentPortal="", currentUser=null;

function openLogin(p){
  currentPortal=p;
  document.getElementById("auth").style.display="flex";
  showLogin();
}

function showLogin(){
  loginBox.style.display="block";
  regBox.style.display="none";
  fpBox.style.display="none";
}
function showRegister(){
  loginBox.style.display="none";
  regBox.style.display="block";
}
function showForgot(){
  loginBox.style.display="none";
  fpBox.style.display="block";
}

function login(){
  let u=luser.value, p=lpass.value;
  let user=users.find(x=>x.user===u && x.pass===p);
  if(!user){lmsg.innerText="Invalid login";return;}
  currentUser=user;
  auth.style.display="none";
  loadPortal();
}

function register(){
  if(users.find(u=>u.user===ruser.value)){
    rmsg.innerText="Username exists";return;
  }
  users.push({user:ruser.value,pass:rpass.value,role:rrole.value,name:rname.value});
  localStorage.setItem("users",JSON.stringify(users));
  rmsg.style.color="green";
  rmsg.innerText="Account created";
}

function recover(){
  let u=users.find(x=>x.user===fpuser.value);
  if(!u){fpmsg.innerText="Not found";return;}
  fpmsg.style.color="green";
  fpmsg.innerText="Password: "+u.pass;
}

function loadPortal(){
  home.style.display="none";
  portal.style.display="block";

  if(currentPortal==="library"){
    portal.innerHTML=`
    <h2>Library Portal</h2>
    <input id="book" placeholder="Book Title">
    <button class="download" onclick="pdf('Library Book',book.value)">Download PDF</button>
    <br><br><button class="logout" onclick="logout()">Logout</button>`;
  }

  if(currentPortal==="masomo"){
    portal.innerHTML=`
    <h2>Masomo Portal</h2>
    <input id="course" placeholder="Course Name">
    <input id="assignment" placeholder="Assignment Title">
    <button class="download" onclick="pdf('Masomo Assignment',course.value+' - '+assignment.value)">Download PDF</button>
    <br><br><button class="logout" onclick="logout()">Logout</button>`;
  }

  if(currentPortal==="student"){
    portal.innerHTML=`
    <h2>Student Portal</h2>
    <input id="unit" placeholder="Unit Name">
    <input id="marks" placeholder="Marks">
    <button class="download" onclick="pdf('Student Result',unit.value+' : '+marks.value)">Download PDF</button>
    <br><br><button class="logout" onclick="logout()">Logout</button>`;
  }

  if(currentPortal==="finance"){
    portal.innerHTML=`
    <h2>Finance Portal</h2>
    <table>
      <tr><th>Total Fees</th><th>Paid</th><th>Balance</th></tr>
      <tr>
        <td><input id="total" value="50000"></td>
        <td><input id="paid" value="20000"></td>
        <td id="balance">30000</td>
      </tr>
    </table>
    <button class="download" onclick="calc()">Calculate</button>
    <button class="download" onclick="pdf('Fee Statement','Balance: '+balance.innerText)">Download PDF</button>
    <br><br><button class="logout" onclick="logout()">Logout</button>`;
  }

  if(currentPortal==="admin"){
    portal.innerHTML=`
    <h2>Admin Portal</h2>
    <ul>${users.map(u=>`<li>${u.name} (${u.role})</li>`).join("")}</ul>
    <button class="logout" onclick="logout()">Logout</button>`;
  }
}

function calc(){
  balance.innerText=total.value-paid.value;
}

function pdf(title,text){
  const d=new jsPDF();
  d.text(title,20,20);
  d.text(text,20,35);
  d.save(title+".pdf");
}

function logout(){
  currentUser=null;
  portal.style.display="none";
  home.style.display="grid";
}
</script>

</body>
</html>
