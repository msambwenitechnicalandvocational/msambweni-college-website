<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MSAMBWENI TECHNICAL AND VOCATIONAL COLLEGE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ===== BODY & BASE ===== */
body{margin:0;font-family:Segoe UI,sans-serif;background:#f0f2f5;}
header{height:60px;background:#1abc9c;color:#fff;display:flex;align-items:center;padding:0 20px;position:fixed;width:100%;top:0;z-index:3;justify-content:space-between;}
header img{height:50px;margin-right:10px;}
#loginBox{width:360px;margin:180px auto;background:#fff;padding:25px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.2);}
#loginBox h3{text-align:center;color:#1abc9c;}
input,select,button{width:100%;padding:12px;margin:8px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;}
input:focus, select:focus{border:2px solid #3498db; outline:none;}
button, .small-btn{background:#3498db; color:white; font-weight:bold; border:none; cursor:pointer; transition:0.3s; border-radius:6px;}
button:hover, .small-btn:hover{background:#2980b9;}
button.pdf-btn{background:#f1c40f; color:#1a237e; font-weight:bold;}
button.pdf-btn:hover{background:#f39c12;}
#portal{display:none;}

/* ===== SIDEBAR ===== */
#sidebar{width:250px;background:#1abc9c;color:white;position:fixed;top:60px;bottom:0;overflow-y:auto;transition:0.3s;}
#sidebar.collapsed{width:60px;}
#sidebar a{display:flex;align-items:center;padding:14px 20px;color:white;text-decoration:none;transition:0.3s;font-weight:bold;}
#sidebar a:hover{background:#16a085; border-radius:5px;}
#sidebar a.active{background:#f1c40f;color:#1a237e;font-weight:bold;}
#sidebar .icon{width:25px;display:inline-block;text-align:center;}
#sidebar .text{flex:1;white-space:nowrap;overflow:hidden;}
#sidebar.collapsed .text{display:none;}
#sidebar .submenu{display:none;padding-left:40px;background:#16a085;border-left:4px solid #f1c40f;border-radius:6px;}
#sidebar.collapsed .submenu{padding-left:0;position:absolute;left:60px;width:200px;top:auto;z-index:10;}
#sidebar .submenu a{color:white;font-weight:normal;}
#sidebar .submenu a:hover{background:#f39c12;}

/* ===== CONTENT ===== */
#content{margin-left:250px;margin-top:60px;padding:20px;transition:0.3s;}
#sidebar.collapsed ~ #content{margin-left:60px;}
.card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.1);margin-bottom:20px;}
.msg{font-weight:bold;color:green;margin-top:10px;}

/* ===== TABLES ===== */
.table{width:100%;border-collapse:collapse;margin-top:15px;}
.table th,.table td{border:1px solid #ccc;padding:8px;text-align:center;}
.table th{background:#1abc9c;color:#fff;}
.table tr:nth-child(even){background:#f2f2f2;}

/* ===== DASHBOARD CARDS ===== */
.dashboard-cards{display:flex;flex-wrap:wrap;gap:15px;margin-top:15px;}
.dashboard-card{flex:1 1 200px;padding:20px;border-radius:10px;color:#fff;font-weight:bold;text-align:center;box-shadow:0 5px 15px rgba(0,0,0,0.1);transition:0.3s;}
.dashboard-card h2{margin:10px 0;font-size:28px;}
.dashboard-card span{font-size:14px;color:#f0f0f0;}
.dashboard-card.card-students{background:#1abc9c;}
.dashboard-card.card-staff{background:#3498db;}
.dashboard-card.card-fees{background:#f1c40f;color:#1a237e;}
.dashboard-card.card-balance{background:#e67e22;}

/* ===== NOTIFICATIONS ===== */
.notification-item{border-left:4px solid #3498db;padding-left:10px;margin:4px 0;}

/* ===== TOGGLE BUTTON ===== */
.toggle-btn{background:#3498db;color:white;font-weight:bold;border-radius:6px;}

/* ===== MODERN BANNERS ===== */
.green-banner{width:100%;background:#1abc9c;color:white;text-align:center;padding:50px 20px;font-size:36px;font-weight:bold;}
.white-banner{width:100%;background:white;color:#000;display:flex;justify-content:space-between;align-items:center;padding:20px 40px;}
.white-banner img{height:90px;}
.mission-banner{width:100%;background:#f0f2f5;color:#333;text-align:center;padding:30px 20px;font-size:18px;line-height:1.6;}

/* ===== RESPONSIVE ===== */
@media(max-width:768px){
  #sidebar{width:100%;position:relative;}
  #sidebar.collapsed{width:100%;}
  #content{margin-left:0;}
  .dashboard-cards{flex-direction:column;}
  .white-banner{flex-direction:column; gap:15px;}
  .white-banner img{height:70px;}
}
</style>
</head>
<body>

<!-- GREEN BANNER -->
<div class="green-banner">MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE</div>

<!-- WHITE BANNER -->
<div class="white-banner">
  <img src="knec.png" alt="KNEC Logo">
  <img src="logo.jpg" alt="College Logo">
</div>

<!-- MISSION & VISION -->
<div class="mission-banner">
  <b>Our Mission:</b> To provide quality technical and vocational education to empower students with practical skills.<br>
  <b>Our Vision:</b> To be a leading technical and vocational college recognized for excellence and innovation.
</div>

<!-- LOGIN BOX -->
<div id="loginBox">
  <h3>MTVC PORTAL</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <select id="role">
    <option value="">Select Role</option>
    <option value="student">Student</option>
    <option value="staff">Staff</option>
    <option value="finance">Finance</option>
    <option value="admin">Admin</option>
  </select>
  <button type="button" onclick="login()">Login</button>
  <button type="button" onclick="signup()">Create Account</button>
  <p id="loginMsg"></p>
</div>

<!-- PORTAL -->
<div id="portal">
<header>
  <div style="display:flex;align-items:center;">
    <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
    <img src="logo.jpg" alt="MTVC Logo">
    <h3 style="margin-left:10px;">MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE</h3>
  </div>
</header>

<div id="sidebar">
  <a onclick="menuClick('dashboard')"><span class="icon">üè†</span><span class="text">Dashboard</span></a>
  <a onclick="toggleSubmenu('studentSub')"><span class="icon">üéì</span><span class="text">Students ‚ñº</span></a>
  <div id="studentSub" class="submenu">
      <a onclick="menuClick('student')">Registration</a>
  </div>
  <a onclick="toggleSubmenu('academicsSub')"><span class="icon">üìò</span><span class="text">Academics ‚ñº</span></a>
  <div id="academicsSub" class="submenu">
      <a onclick="menuClick('academics')">Results</a>
      <a onclick="menuClick('notifications')">Notifications</a>
  </div>
  <a onclick="toggleSubmenu('financeSub')"><span class="icon">üí∞</span><span class="text">Finance ‚ñº</span></a>
  <div id="financeSub" class="submenu">
      <a onclick="menuClick('finance')">Fee Payment</a>
  </div>
  <a onclick="toggleSubmenu('staffSub')"><span class="icon">üë®‚Äçüè´</span><span class="text">Staff ‚ñº</span></a>
  <div id="staffSub" class="submenu">
      <a onclick="menuClick('staff')">Staff Details</a>
  </div>
  <a onclick="toggleSubmenu('adminSub')"><span class="icon">‚öô</span><span class="text">Admin ‚ñº</span></a>
  <div id="adminSub" class="submenu">
      <a onclick="menuClick('admin')">Settings</a>
  </div>
  <a onclick="logout()"><span class="icon">üö™</span><span class="text">Logout</span></a>
</div>

<div id="content">
  <!-- Dashboard -->
  <div class="card" id="dashboard">
    <h3>Dashboard</h3>
    <div class="dashboard-cards">
      <div class="dashboard-card card-students"><h2 id="totalStudents">0</h2><span>Total Students</span></div>
      <div class="dashboard-card card-staff"><h2 id="totalStaff">0</h2><span>Total Staff</span></div>
      <div class="dashboard-card card-fees"><h2 id="totalFees">0</h2><span>Total Fees Paid</span></div>
      <div class="dashboard-card card-balance"><h2 id="totalBalance">0</h2><span>Total Balance</span></div>
    </div>
  </div>

  <!-- STUDENT -->
  <form class="card" id="student" onsubmit="return false;">
    <h3>Student Registration</h3>
    <input id="stuName" placeholder="Name">
    <input id="stuReg" placeholder="Reg No">
    <input id="stuEmail" placeholder="Email">
    <input id="stuTerm" placeholder="Term">
    <input id="stuYear" placeholder="Year">
    <input id="stuCourse" placeholder="Course">
    <button type="button" class="pdf-btn" onclick="saveStudent()">Save & Download PDF</button>
    <p class="msg" id="stuMsg"></p>
  </form>

  <!-- FINANCE -->
  <form class="card" id="finance" onsubmit="return false;">
    <h3>Finance</h3>
    <input id="fReg" placeholder="Reg No">
    <input id="fName" placeholder="Name">
    <input id="fPaid" type="number" placeholder="Amount Paid">
    <input id="fTerm" placeholder="Term">
    <input id="fYear" placeholder="Year">
    <button type="button" class="pdf-btn" onclick="saveFinance()">Save & Download Fee PDF</button>
    <p class="msg" id="fMsg"></p>
  </form>

  <!-- ACADEMICS -->
  <form class="card" id="academics" onsubmit="return false;">
    <h3>Academic Results</h3>
    <input id="aReg" placeholder="Reg No">
    <input id="aName" placeholder="Name">
    <input id="aUnit" placeholder="Unit">
    <input id="aScore" type="number" placeholder="Score">
    <input id="aTerm" placeholder="Term">
    <input id="aYear" placeholder="Year">
    <button type="button" class="pdf-btn" onclick="saveResult()">Save & Download PDF</button>
    <p class="msg" id="aMsg"></p>
  </form>

  <!-- NOTIFICATIONS -->
  <div class="card" id="notifications">
    <h3>Notifications</h3>
    <div id="notifyList"></div>
  </div>

  <!-- STAFF -->
  <form class="card" id="staff" onsubmit="return false;">
    <h3>Staff Details</h3>
    <input id="sName" placeholder="Name">
    <input id="sRole" placeholder="Role">
    <input id="sEmail" placeholder="Email">
    <input id="sPhone" placeholder="Phone">
    <input id="sDept" placeholder="Department">
    <button type="button" class="pdf-btn" onclick="saveStaff()">Save & Download PDF</button>
    <p class="msg" id="sMsg"></p>
  </form>

  <!-- ADMIN -->
  <form class="card" id="admin" onsubmit="return false;">
    <h3>Admin Settings</h3>
    <input id="adName" placeholder="Setting">
    <button type="button" onclick="saveAdmin()">Save</button>
    <p class="msg" id="adMsg"></p>
  </form>
</div>
</div>

<script>
// Firebase initialization
firebase.initializeApp({
 apiKey:"AIzaSyAhiabnqiPW1Y_USf7r_UW2KymUyfiYmVs",
 authDomain:"studentregistration-b3f93.firebaseapp.com",
 projectId:"studentregistration-b3f93",
 databaseURL:"https://studentregistration-b3f93-default-rtdb.firebaseio.com"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* ===== SIGNUP ===== */
async function signup(){
  if(!email.value||!password.value||!role.value){loginMsg.innerText="Fill all fields"; return;}
  loginMsg.style.color="blue"; loginMsg.innerText="Creating account...";
  try{
    const existing = await db.collection("users").where("email","==",email.value).get();
    if(existing.size>0){loginMsg.innerText=`Account with this email exists`; return;}
    const cred = await auth.createUserWithEmailAndPassword(email.value,password.value);
    await db.collection("users").doc(cred.user.uid).set({email:email.value, role:role.value});
    loginMsg.style.color="green"; loginMsg.innerText="‚úÖ Account created successfully!";
  }catch(e){loginMsg.style.color="red"; loginMsg.innerText=e.message;}
}

/* ===== LOGIN ===== */
async function login(){
  loginMsg.style.color="blue"; loginMsg.innerText="Logging in...";
  try{
    const cred = await auth.signInWithEmailAndPassword(email.value,password.value);
    const doc = await db.collection("users").doc(cred.user.uid).get();
    if(!doc.exists){loginMsg.style.color="red"; loginMsg.innerText="User data not found"; return;}
    const userRole = doc.data().role || "unknown";

    loginBox.style.display="none";
    portal.style.display="block";
    loginMsg.style.color="green"; loginMsg.innerText="üéâ Logged in!";
    updateDashboard();
    loadNotifications();

    const financeElements = document.querySelectorAll("#finance, #financeSub");
    const studentElements = document.querySelectorAll("#student, #studentSub");
    const staffElements = document.querySelectorAll("#staff, #staffSub");
    const adminElements = document.querySelectorAll("#admin, #adminSub");

    if(userRole==="student"){
      financeElements.forEach(e=>e.style.display="none");
      staffElements.forEach(e=>e.style.display="none");
      adminElements.forEach(e=>e.style.display="none");
    } else if(userRole==="staff"){
      financeElements.forEach(e=>e.style.display="none");
      studentElements.forEach(e=>e.style.display="none");
      adminElements.forEach(e=>e.style.display="none");
    } else if(userRole==="finance"){
      studentElements.forEach(e=>e.style.display="none");
      staffElements.forEach(e=>e.style.display="none");
      adminElements.forEach(e=>e.style.display="none");
    }
  }catch(e){loginMsg.style.color="red"; loginMsg.innerText=e.message;}
}

/* ===== SIDEBAR ===== */
function toggleSidebar(){document.getElementById("sidebar").classList.toggle("collapsed");}
function menuClick(id){document.querySelectorAll("#content > .card, #content > div").forEach(d=>d.style.display="none"); document.getElementById(id).style.display="block";}
function toggleSubmenu(id){const el=document.getElementById(id); el.style.display=el.style.display==='block'?'none':'block';}
function logout(){auth.signOut(); location.reload();}

/* ===== DASHBOARD ===== */
async function updateDashboard(){
  const studentsSnap = await db.collection("students").get();
  const staffSnap = await db.collection("staff").get();
  const financeSnap = await db.collection("finance").get();
  document.getElementById("totalStudents").innerText = studentsSnap.size;
  document.getElementById("totalStaff").innerText = staffSnap.size;
  let totalPaid=0, totalBalance=0;
  financeSnap.forEach(d=>{totalPaid+=d.data().paid||0; totalBalance+=((40000-d.data().paid)||0);});
  document.getElementById("totalFees").innerText = totalPaid;
  document.getElementById("totalBalance").innerText = totalBalance;
}

/* ===== SAVE & PDF ===== */
function alertEmptyFields(obj,message){for(const key in obj){if(obj[key]===""||obj[key]===null||obj[key]===undefined||obj[key]===0){alert(message); return true;}}return false;}

async function saveStudent(){
  const data={name:stuName.value, reg:stuReg.value, email:stuEmail.value, term:stuTerm.value, year:stuYear.value, course:stuCourse.value};
  if(alertEmptyFields(data,"Please fill all student fields")) return;
  data.timestamp=new Date().toLocaleString();
  await db.collection("students").doc(data.reg).set(data);
  stuMsg.innerText="Saved ‚úÖ"; downloadStudentPDF(data);
  loadNotifications();
}

async function saveFinance(){
  const data={reg:fReg.value, name:fName.value, paid:parseFloat(fPaid.value)||0, term:fTerm.value, year:fYear.value};
  if(alertEmptyFields(data,"Please fill all finance fields")) return;
  data.balance=40000-data.paid; data.timestamp=new Date().toLocaleString();
  await db.collection("finance").doc(data.reg+data.term+data.year).set(data);
  fMsg.innerText="Saved ‚úÖ"; downloadFinancePDF(data);
  loadNotifications();
}

function getGrade(score){if(score>=80) return "Mastery"; if(score>=70) return "Proficient"; if(score>=60) return "Competent"; return "Not Competent";}
async function saveResult(){const data={reg:aReg.value, name:aName.value, unit:aUnit.value, score:parseFloat(aScore.value)||0, term:aTerm.value, year:aYear.value}; if(alertEmptyFields(data,"Please fill all academic result fields")) return; data.grade=getGrade(data.score); data.timestamp=new Date().toLocaleString(); await db.collection("academics").doc(data.reg+data.unit+data.term+data.year).set(data); aMsg.innerText="Saved ‚úÖ"; downloadResultPDF(data); loadNotifications();}
async function saveStaff(){const data={name:sName.value, role:sRole.value, email:sEmail.value, phone:sPhone.value, dept:sDept.value}; if(alertEmptyFields(data,"Please fill all staff fields")) return; data.timestamp=new Date().toLocaleString(); await db.collection("staff").doc(data.email).set(data); sMsg.innerText="Saved ‚úÖ"; downloadStaffPDF(data); loadNotifications();}
function saveAdmin(){adMsg.innerText="Saved ‚úÖ";}

/* ===== NOTIFICATIONS ===== */
async function loadNotifications(){
  const notifyList = document.getElementById("notifyList");
  notifyList.innerHTML = "";
  const studentsSnap = await db.collection("students").orderBy("timestamp","desc").limit(5).get();
  studentsSnap.forEach(doc=>{const d=doc.data(); notifyList.innerHTML += `<div class="notification-item">Student Registered: <b>${d.name}</b> (${d.reg}) at ${d.timestamp}</div>`;});
  const financeSnap = await db.collection("finance").orderBy("timestamp","desc").limit(5).get();
  financeSnap.forEach(doc=>{const d=doc.data(); notifyList.innerHTML += `<div class="notification-item">Fee Paid: <b>${d.name}</b> (${d.reg}) Ksh ${d.paid} at ${d.timestamp}</div>`;});
  const academicsSnap = await db.collection("academics").orderBy("timestamp","desc").limit(5).get();
  academicsSnap.forEach(doc=>{const d=doc.data(); notifyList.innerHTML += `<div class="notification-item">Result Added: <b>${d.name}</b> (${d.reg}) Score: ${d.score} Grade: ${d.grade} at ${d.timestamp}</div>`;});
}

/* ===== PDF DOWNLOADS (TABLE FORMAT WITH COLORS) ===== */
function downloadStudentPDF(d){
    const doc = new jspdf.jsPDF();
    doc.setFontSize(16);
    doc.setTextColor(255,255,255);
    doc.setFillColor(26,188,156); doc.rect(0,0,210,15,'F');
    doc.text("STUDENT RECORD",105,10,null,null,'center');
    doc.setFontSize(12); doc.setTextColor(0,0,0);
    const tableData=[["Name",d.name],["Reg No",d.reg],["Email",d.email],["Course",d.course],["Term",d.term],["Year",d.year],["Timestamp",d.timestamp]];
    let y=25; tableData.forEach(r=>{doc.setFillColor(236,240,241); doc.rect(10,y-8,190,8,'F'); doc.text(`${r[0]}: ${r[1]}`,12,y); y+=10;});
    doc.save(`Student_${d.reg}.pdf`);
}
function downloadFinancePDF(d){
    const doc = new jspdf.jsPDF();
    doc.setFontSize(16); doc.setTextColor(255,255,255); doc.setFillColor(241,196,15); doc.rect(0,0,210,15,'F'); doc.text("FINANCE RECORD",105,10,null,null,'center');
    doc.setFontSize(12); doc.setTextColor(0,0,0);
    const tableData=[["Name",d.name],["Reg No",d.reg],["Term",d.term],["Year",d.year],["Paid","Ksh "+d.paid],["Balance","Ksh "+d.balance],["Timestamp",d.timestamp]];
    let y=25; tableData.forEach(r=>{doc.setFillColor(236,240,241); doc.rect(10,y-8,190,8,'F'); doc.text(`${r[0]}: ${r[1]}`,12,y); y+=10;});
    doc.save(`Fee_${d.reg}_${d.term}_${d.year}.pdf`);
}
function downloadResultPDF(d){
    const doc = new jspdf.jsPDF();
    doc.setFontSize(16); doc.setTextColor(255,255,255); doc.setFillColor(52,152,219); doc.rect(0,0,210,15,'F'); doc.text("ACADEMIC RESULT",105,10,null,null,'center');
    doc.setFontSize(12); doc.setTextColor(0,0,0);
    const tableData=[["Name",d.name],["Reg No",d.reg],["Unit",d.unit],["Score",d.score],["Grade",d.grade],["Term",d.term],["Year",d.year],["Timestamp",d.timestamp]];
    let y=25; tableData.forEach(r=>{doc.setFillColor(236,240,241); doc.rect(10,y-8,190,8,'F'); doc.text(`${r[0]}: ${r[1]}`,12,y); y+=10;});
    doc.save(`Result_${d.reg}_${d.unit}.pdf`);
}
function downloadStaffPDF(d){
    const doc = new jspdf.jsPDF();
    doc.setFontSize(16); doc.setTextColor(255,255,255); doc.setFillColor(231,76,60); doc.rect(0,0,210,15,'F'); doc.text("STAFF RECORD",105,10,null,null,'center');
    doc.setFontSize(12); doc.setTextColor(0,0,0);
    const tableData=[["Name",d.name],["Role",d.role],["Email",d.email],["Phone",d.phone],["Department",d.dept],["Timestamp",d.timestamp]];
    let y=25; tableData.forEach(r=>{doc.setFillColor(236,240,241); doc.rect(10,y-8,190,8,'F'); doc.text(`${r[0]}: ${r[1]}`,12,y); y+=10;});
    doc.save(`Staff_${d.email}.pdf`);
}
</script>

<!-- ICT PORTAL MODERN -->
<div id="ictPortal" style="font-family:Segoe UI,sans-serif;">

  <!-- HEADER BANNER -->
  <div class="ict-header">
    ICT PORTAL - MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE
  </div>

  <!-- LOGIN/SIGNUP/RESET CONTAINER -->
  <div class="form-container">

    <!-- LOGIN FORM -->
    <div id="loginForm" class="form-card">
      <h2>Login</h2>
      <input id="loginEmail" type="email" placeholder="Email">
      <input id="loginPassword" type="password" placeholder="Password">
      <button onclick="loginUser()" class="btn-blue">Login</button>
      <p class="form-switch">
        <a href="#" onclick="showSignup()">Create Account</a> | 
        <a href="#" onclick="showReset()">Reset Password</a>
      </p>
      <p id="loginMsg" class="msg"></p>
    </div>

    <!-- SIGNUP FORM -->
    <div id="signupForm" class="form-card" style="display:none;">
      <h2>Create Account</h2>
      <input id="signupEmail" type="email" placeholder="Email">
      <input id="signupPassword" type="password" placeholder="Password">
      <input id="signupRole" type="text" placeholder="Role (student/staff/admin)">
      <button onclick="signupUser()" class="btn-green">Sign Up</button>
      <p class="form-switch">
        <a href="#" onclick="showLogin()">Back to Login</a>
      </p>
      <p id="signupMsg" class="msg"></p>
    </div>

    <!-- RESET PASSWORD FORM -->
    <div id="resetForm" class="form-card" style="display:none;">
      <h2>Reset Password</h2>
      <input id="resetEmail" type="email" placeholder="Enter your email">
      <button onclick="resetPassword()" class="btn-orange">Send Reset Link</button>
      <p class="form-switch">
        <a href="#" onclick="showLogin()">Back to Login</a>
      </p>
      <p id="resetMsg" class="msg"></p>
    </div>

  </div>

  <!-- DASHBOARD (hidden initially) -->
  <div id="dashboardPortal" style="display:none;">
    <header class="dashboard-header">
      <button onclick="toggleSidebar()" class="toggle-btn">‚ò∞</button>
      <span>ICT Dashboard</span>
      <button onclick="logoutUser()" class="btn-red">Logout</button>
    </header>

    <aside id="sidebar" class="sidebar">
      <a onclick="menuClick('dashboardCard')" class="active">üè† Dashboard</a>
      <a onclick="menuClick('notificationsCard')">üîî Notifications</a>
      <a onclick="menuClick('studentsCard')">üéì Students</a>
      <a onclick="menuClick('staffCard')">üë®‚Äçüè´ Staff</a>
      <a onclick="menuClick('financeCard')">üí∞ Finance</a>
    </aside>

    <main id="content">
      <div id="dashboardCard" class="card">
        <h3>Dashboard</h3>
        <div class="dashboard-cards">
          <div class="dashboard-card card-students"><h2 id="totalStudents">0</h2><span>Total Students</span></div>
          <div class="dashboard-card card-staff"><h2 id="totalStaff">0</h2><span>Total Staff</span></div>
          <div class="dashboard-card card-fees"><h2 id="totalFees">0</h2><span>Total Fees Paid</span></div>
        </div>
      </div>

      <div id="notificationsCard" class="card" style="display:none;">
        <h3>Recent Notifications</h3>
        <div id="notifyList"></div>
      </div>

      <div id="studentsCard" class="card" style="display:none;">
        <h3>Students</h3>
        <table id="studentsTable" class="table"></table>
      </div>

      <div id="staffCard" class="card" style="display:none;">
        <h3>Staff</h3>
        <table id="staffTable" class="table"></table>
      </div>

      <div id="financeCard" class="card" style="display:none;">
        <h3>Finance</h3>
        <table id="financeTable" class="table"></table>
      </div>
    </main>
  </div>

</div>

<style>
/* ===== GENERAL ===== */
body{margin:0;background:#f0f2f5;}
.ict-header{background:#3498db;color:white;text-align:center;padding:40px 20px;font-size:28px;font-weight:bold;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
.form-container{max-width:400px;margin:40px auto;}
.form-card{background:white;padding:25px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.1);margin-bottom:20px;}
input{width:100%;padding:12px;margin:8px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;}
button{width:100%;padding:12px;margin-top:8px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;font-size:14px;}
.btn-blue{background:#3498db;color:white;}
.btn-blue:hover{background:#2980b9;}
.btn-green{background:#2ecc71;color:white;}
.btn-green:hover{background:#27ae60;}
.btn-orange{background:#f39c12;color:white;}
.btn-orange:hover{background:#e67e22;}
.btn-red{background:#e74c3c;color:white;}
.btn-red:hover{background:#c0392b;}
.msg{font-weight:bold;text-align:center;margin-top:10px;}
.form-switch{text-align:center;margin-top:10px;}
.form-switch a{color:#3498db;text-decoration:none;}
.form-switch a:hover{text-decoration:underline;}

/* ===== DASHBOARD ===== */
.dashboard-header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#3498db;color:white;position:sticky;top:0;z-index:10;}
.toggle-btn{background:#2980b9;color:white;padding:10px;border-radius:6px;border:none;cursor:pointer;}
.sidebar{width:220px;position:fixed;top:60px;left:0;background:#1abc9c;color:white;height:100%;overflow-y:auto;padding-top:20px;transition:0.3s;}
.sidebar a{display:block;padding:12px 20px;color:white;text-decoration:none;margin-bottom:2px;border-radius:6px;}
.sidebar a:hover,.sidebar a.active{background:#16a085;}
#content{margin-left:240px;padding:20px;transition:0.3s;}
.card{background:white;padding:20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.1);margin-bottom:20px;}
.dashboard-cards{display:flex;gap:15px;margin-top:15px;}
.dashboard-card{flex:1;padding:20px;border-radius:10px;color:white;text-align:center;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
.card-students{background:#3498db;}
.card-staff{background:#2ecc71;}
.card-fees{background:#f1c40f;color:#1a237e;}
.table{width:100%;border-collapse:collapse;margin-top:15px;}
.table th,.table td{border:1px solid #ccc;padding:8px;text-align:center;}
.table th{background:#3498db;color:white;}
.table tr:nth-child(even){background:#f2f2f2;}
</style>

<script type="module">
  // ===== FIREBASE IMPORTS =====
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ===== FIREBASE CONFIG =====
  const firebaseConfig = {
    apiKey: "AIzaSyAhiabnqiPW1Y_USf7r_UW2KymUyfiYmVs",
    authDomain: "studentregistration-b3f93.firebaseapp.com",
    databaseURL: "https://studentregistration-b3f93-default-rtdb.firebaseio.com",
    projectId: "studentregistration-b3f93",
    storageBucket: "studentregistration-b3f93.firebasestorage.app",
    messagingSenderId: "429282074438",
    appId: "1:429282074438:web:d50150839003b34a3ecf47",
    measurementId: "G-8CG0TSN909"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth();
  const db = getFirestore();

  // ===== FORM SWITCH =====
  function showSignup(){document.getElementById('loginForm').style.display='none';document.getElementById('signupForm').style.display='block';document.getElementById('resetForm').style.display='none';clearMsgs();}
  function showLogin(){document.getElementById('loginForm').style.display='block';document.getElementById('signupForm').style.display='none';document.getElementById('resetForm').style.display='none';clearMsgs();}
  function showReset(){document.getElementById('loginForm').style.display='none';document.getElementById('signupForm').style.display='none';document.getElementById('resetForm').style.display='block';clearMsgs();}
  function clearMsgs(){document.getElementById('loginMsg').innerText='';document.getElementById('signupMsg').innerText='';document.getElementById('resetMsg').innerText='';}

  // ===== SIGNUP =====
  async function signupUser(){
    const email=document.getElementById('signupEmail').value;
    const password=document.getElementById('signupPassword').value;
    const role=document.getElementById('signupRole').value || "student";
    const msg=document.getElementById('signupMsg');
    if(!email||!password){msg.innerText="Fill all fields!"; return;}
    msg.style.color='blue'; msg.innerText='Creating account...';
    try{
      const q=query(collection(db,"users"), orderBy("email"), limit(1));
      const cred=await createUserWithEmailAndPassword(auth,email,password);
      await setDoc(doc(db,"users",cred.user.uid),{email,role});
      msg.style.color='green'; msg.innerText='‚úÖ Account created successfully!';
    }catch(e){msg.style.color='red'; msg.innerText=e.message;}
  }

  // ===== LOGIN =====
  async function loginUser(){
    const email=document.getElementById('loginEmail').value;
    const password=document.getElementById('loginPassword').value;
    const msg=document.getElementById('loginMsg');
    if(!email||!password){msg.innerText="Fill all fields!"; return;}
    msg.style.color='blue'; msg.innerText='Logging in...';
    try{
      const cred=await signInWithEmailAndPassword(auth,email,password);
      const docSnap=await getDoc(doc(db,"users",cred.user.uid));
      const role=docSnap.data().role||"unknown";
      msg.style.color='green'; msg.innerText=`üéâ Logged in as ${role}`;
      document.getElementById('dashboardPortal').style.display='block';
      document.getElementById('loginForm').style.display='none';
      loadDashboard();
    }catch(e){msg.style.color='red'; msg.innerText=e.message;}
  }

  // ===== RESET PASSWORD =====
  async function resetPassword(){
    const email=document.getElementById('resetEmail').value;
    const msg=document.getElementById('resetMsg');
    if(!email){msg.innerText="Enter email!"; return;}
    try{
      await sendPasswordResetEmail(auth,email);
      msg.style.color='green'; msg.innerText="‚úÖ Reset link sent!";
    }catch(e){msg.style.color='red'; msg.innerText=e.message;}
  }

  // ===== LOGOUT =====
  async function logoutUser(){
    await signOut(auth);
    location.reload();
  }

  // ===== SIDEBAR & MENU =====
  function toggleSidebar(){document.getElementById('sidebar').classList.toggle('collapsed');}
  function menuClick(id){
    document.querySelectorAll('#content > .card').forEach(c=>c.style.display='none');
    document.getElementById(id).style.display='block';
  }

  // ===== DASHBOARD DATA =====
  async function loadDashboard(){
    const studentsSnap=await getDocs(collection(db,"students"));
    const staffSnap=await getDocs(collection(db,"staff"));
    const financeSnap=await getDocs(collection(db,"finance"));
    document.getElementById('totalStudents').innerText=studentsSnap.size;
    document.getElementById('totalStaff').innerText=staffSnap.size;
    let totalFees=0; financeSnap.forEach(d=>totalFees+=(d.data().paid||0));
    document.getElementById('totalFees').innerText=totalFees;

    // Notifications
    const notifyList=document.getElementById('notifyList'); notifyList.innerHTML='';
    const recentStudents=studentsSnap.docs.slice(-5).reverse();
    recentStudents.forEach(d=>notifyList.innerHTML+=`<div>${d.data().name} registered</div>`);
  }
</script>




  
</body>
</html>



<!-- FOOTER -->
<footer class="footer">
  <div class="footer-container">
    <div class="footer-brand">
      <strong>MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE</strong><br>
      P.O. Box 123, Msambweni, Kwale County, Kenya
    </div>
    <div class="footer-contact">
      <span>Email: info@mtvc.ac.ke</span> | 
      <span>Phone: +254 701 234 567</span>
    </div>
    <div class="footer-links">
      <strong>Resources:</strong>
      <a href="https://www.youtube.com/@MSAMBWENI-TVC" target="_blank"><i class="fab fa-youtube"></i> MTVC</a>
      <a href="https://www.kuccps.ac.ke" target="_blank">KUCCPS</a>
      <a href="https://www.helb.co.ke" target="_blank">HELB</a>
      <a href="https://www.cdacc.go.ke" target="_blank">CDACC</a>
    </div>
    <div class="footer-social">
      <a href="#"><i class="fab fa-facebook"></i> Facebook</a>
      <a href="#"><i class="fab fa-twitter"></i> Twitter</a>
      <a href="#"><i class="fab fa-instagram"></i> Instagram</a>
    </div>
  </div>
  <div class="footer-copy">&copy; 2026 MSAMBWENI TVC. All rights reserved.</div>
</footer>

<!-- FONT AWESOME LINK -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
/* FOOTER STYLING - BLUE VERSION */
.footer {
  background: #0d47a1; /* Blue background */
  color: white;
  padding: 30px 50px 15px 50px;
  font-family: 'Segoe UI', sans-serif;
  margin-top: 20px;
}

.footer-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 15px;
  max-width: 1200px;
  margin: auto;
}

.footer a {
  color: white;
  margin: 0 8px;
  text-decoration: none;
  font-weight: bold;
  transition: 0.3s;
}

.footer a:hover {
  color: #f1c40f; /* Yellow hover for contrast */
  text-decoration: underline;
}

.footer-brand, .footer-contact, .footer-social, .footer-links {
  flex: 1 1 200px;
  text-align: center;
  margin: 5px 0;
}

.footer-copy {
  margin-top: 15px;
  font-size: 13px;
  text-align: center;
  color: #f0f0f0;
  border-top: 1px solid rgba(255,255,255,0.3);
  padding-top: 10px;
}

.footer a i {
  margin-right: 5px;
}

/* Responsive Footer */
@media(max-width:768px){
  .footer-container {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  .footer a {margin: 5px;}
}
</style>





