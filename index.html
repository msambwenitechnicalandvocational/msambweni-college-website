<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Msambweni TVC Portals</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- jsPDF & AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
:root{
  --blue:#0d47a1;
  --light:#1976d2;
  --green:#2e7d32;
  --red:#c62828;
}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#f4f7fb;}
header{background:linear-gradient(90deg,var(--blue),var(--light));color:white;padding:15px;text-align:center;}
header h1{margin:0;font-size:20px;}
.container{max-width:1100px;margin:auto;padding:20px;}
.card{background:white;border-radius:14px;padding:25px;box-shadow:0 15px 35px rgba(0,0,0,.15);margin-bottom:30px;}
h2,h3{text-align:center;color:var(--blue);}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;}
button{padding:10px 18px;border:none;border-radius:6px;color:white;cursor:pointer;margin-top:8px;}
button.portalBtn{background:var(--light);}
button.submit{background:var(--green);}
button.download{background:var(--green);}
button.logout{background:var(--red);}
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:14px;}
th,td{border:1px solid #ccc;padding:10px;text-align:center;}
th{background:var(--light);color:white;}
tbody tr:nth-child(even){background:#f0f4f8;}
tbody tr:hover{background:#dbe9fc;}
.hidden{display:none;}
.unit{border:1px solid #ccc;padding:10px;border-radius:10px;margin-bottom:10px;background:#f9f9f9;}
@media(max-width:768px){
  .card{padding:15px;}
  input, select, button{font-size:14px;}
  table th, table td{padding:6px;font-size:12px;}
  button{padding:8px 12px;}
}
</style>
</head>
<body>

<header>
<h1>MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE</h1>
</header>

<div class="container">

<!-- PORTAL SELECTION -->
<div class="card" id="portalSelect">
  <h2>Select Portal</h2>
  <button class="portalBtn" onclick="openPortal('ict')">ICT Portal</button>
  <button class="portalBtn" onclick="openPortal('library')">Library Portal</button>
</div>

<!-- ICT PORTAL -->
<div class="card hidden" id="ict">
  <h3>ICT Support Portal</h3>
  <table id="ictTable">
    <thead><tr><th>ID</th><th>Name</th><th>Issue</th><th>Device</th><th>Date</th></tr></thead>
    <tbody></tbody>
  </table>
  <input id="ictName" placeholder="Your Name">
  <input id="ictIssue" placeholder="Issue Description">
  <input id="ictDevice" placeholder="Device / Serial Number">
  <input type="date" id="ictDate">
  <button class="submit" onclick="saveICTTicket()">Submit Ticket</button>
  <button class="download" onclick="downloadICTPDF()">Download PDF</button>
  <button class="logout" onclick="closePortal()">Back</button>
</div>

<!-- LIBRARY PORTAL -->
<div class="card hidden" id="library">
  <h3>Library Portal</h3>
  <input id="libStudent" placeholder="Student Name">
  <input id="libCourse" placeholder="Course">
  <input id="libBook" placeholder="Book Title">
  <input id="libAuthor" placeholder="Author">
  <select id="libAction"><option>Borrow</option><option>Return</option></select>
  <button class="submit" onclick="saveLibraryEntry()">Save Entry</button>
  <button class="download" onclick="downloadLibraryPDF()">Download PDF</button>
  <table id="libTable">
    <thead><tr><th>Student</th><th>Course</th><th>Book</th><th>Author</th><th>Action</th><th>Date</th></tr></thead>
    <tbody></tbody>
  </table>
  <button class="logout" onclick="closePortal()">Back</button>
</div>

<footer style="text-align:center;padding:20px;background:var(--blue);color:white;">Prepared by ICT Dept Â© 2026</footer>

<script>
const { jsPDF } = window.jspdf;

// ===== STORAGE =====
if(!localStorage.getItem('ictTickets')) localStorage.setItem('ictTickets',JSON.stringify([]));
if(!localStorage.getItem('libEntries')) localStorage.setItem('libEntries',JSON.stringify([]));

// ===== PORTAL SWITCH =====
function openPortal(p){
  document.getElementById('portalSelect').classList.add('hidden');
  document.getElementById(p).classList.remove('hidden');
  if(p==='ict') loadICTTickets();
  if(p==='library') loadLibraryTable();
}
function closePortal(){
  document.querySelectorAll('#ict,#library').forEach(e=>e.classList.add('hidden'));
  document.getElementById('portalSelect').classList.remove('hidden');
}

// ===== ICT FUNCTIONS =====
function saveICTTicket(){
  const name=document.getElementById('ictName').value;
  const issue=document.getElementById('ictIssue').value;
  const device=document.getElementById('ictDevice').value;
  const date=document.getElementById('ictDate').value;
  if(!name||!issue||!device||!date){alert('Fill all fields'); return;}
  let tickets=JSON.parse(localStorage.getItem('ictTickets'));
  tickets.push({id:tickets.length+1,name,issue,device,date});
  localStorage.setItem('ictTickets',JSON.stringify(tickets));
  loadICTTickets();
  document.getElementById('ictName').value='';
  document.getElementById('ictIssue').value='';
  document.getElementById('ictDevice').value='';
  document.getElementById('ictDate').value='';
}
function loadICTTickets(){
  let tickets=JSON.parse(localStorage.getItem('ictTickets'));
  const tbody=document.querySelector('#ictTable tbody');
  tbody.innerHTML='';
  tickets.forEach(t=>{tbody.innerHTML+=`<tr><td>${t.id}</td><td>${t.name}</td><td>${t.issue}</td><td>${t.device}</td><td>${t.date}</td></tr>`;});
}
function downloadICTPDF(){
  const tickets=JSON.parse(localStorage.getItem('ictTickets'));
  const doc=new jsPDF();
  doc.text('ICT Tickets',14,20);
  doc.autoTable({head:[['ID','Name','Issue','Device','Date']],body:tickets.map(t=>[t.id,t.name,t.issue,t.device,t.date])});
  doc.save('ICT_Tickets.pdf');
}

// ===== LIBRARY FUNCTIONS =====
function saveLibraryEntry(){
  const student=document.getElementById('libStudent').value;
  const course=document.getElementById('libCourse').value;
  const book=document.getElementById('libBook').value;
  const author=document.getElementById('libAuthor').value;
  const action=document.getElementById('libAction').value;
  if(!student||!book){alert('Fill student and book'); return;}
  let entries=JSON.parse(localStorage.getItem('libEntries'));
  entries.push({student,course,book,author,action,date:new Date().toLocaleDateString()});
  localStorage.setItem('libEntries',JSON.stringify(entries));
  loadLibraryTable();
  document.getElementById('libStudent').value='';
  document.getElementById('libCourse').value='';
  document.getElementById('libBook').value='';
  document.getElementById('libAuthor').value='';
}
function loadLibraryTable(){
  let entries=JSON.parse(localStorage.getItem('libEntries'));
  const tbody=document.querySelector('#libTable tbody');
  tbody.innerHTML='';
  entries.forEach(e=>{tbody.innerHTML+=`<tr><td>${e.student}</td><td>${e.course}</td><td>${e.book}</td><td>${e.author}</td><td>${e.action}</td><td>${e.date}</td></tr>`;});
}
function downloadLibraryPDF(){
  const entries=JSON.parse(localStorage.getItem('libEntries'));
  const doc=new jsPDF();
  doc.text('Library Records',14,20);
  doc.autoTable({head:[['Student','Course','Book','Author','Action','Date']],body:entries.map(e=>[e.student,e.course,e.book,e.author,e.action,e.date])});
  doc.save('Library_Records.pdf');
}
</script>

</body>
</html>
