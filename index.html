<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Msambweni TVC Portals</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
:root{
  --blue:#0d47a1;
  --light:#1976d2;
  --green:#2e7d32;
  --red:#c62828;
}
body{margin:0;font-family:Segoe UI,Arial;background:#f4f7fb;}
header{
  background:linear-gradient(90deg,var(--blue),var(--light));
  color:white;
  padding:15px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
header img{height:60px}
header h1{margin:0;font-size:20px;text-align:center;flex:1}
.container{max-width:1100px;margin:auto;padding:20px}
.card{background:white;border-radius:14px;padding:25px;box-shadow:0 15px 35px rgba(0,0,0,.2);margin-bottom:30px;}
h2,h3{text-align:center;color:var(--blue)}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc}
button{padding:10px 18px;border:none;border-radius:6px;color:white;cursor:pointer;margin-top:8px;}
.login{background:var(--light)}
.create{background:var(--green)}
.download{background:var(--green)}
.logout{background:var(--red)}
.link{text-align:center;color:var(--light);cursor:pointer;margin-top:8px;font-size:14px}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:10px;text-align:center}
th{background:var(--light);color:white}
footer{background:#0d47a1;color:white;padding:20px;text-align:center;margin-top:40px}
</style>
</head>
<body>

<header>
<img src="images/logo-left.png">
<h1>MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE</h1>
<img src="images/logo-right.png">
</header>

<div class="container">

<!-- PORTAL SELECTION -->
<div class="card" id="portalSelect">
<h2>Select Portal</h2>
<button class="login" onclick="openAuth('ict')">ICT Portal</button>
<button class="login" onclick="openAuth('library')">Library Portal</button>
<button class="login" onclick="openAuth('exam')">Exam Portal</button>
<button class="login" onclick="openAuth('finance')">Finance Portal</button>
</div>

<!-- AUTH MODAL -->
<div class="card hidden" id="auth">
<h3 id="authTitle"></h3>
<input id="aUser" placeholder="Username">
<input id="aPass" type="password" placeholder="Password">
<button class="login" onclick="login()">Login</button>
<div class="link" onclick="showCreate()">Create Account</div>
<div class="link" onclick="showForgot()">Forgot Password?</div>
<p id="authMsg"></p>
</div>

<div class="card hidden" id="create">
<h3>Create Account</h3>
<input id="cUser" placeholder="Username">
<input id="cPass" type="password" placeholder="Password">
<button class="create" onclick="createAccount()">Create Account</button>
<div class="link" onclick="backAuth()">Back to Login</div>
</div>

<div class="card hidden" id="forgot">
<h3>Recover Password</h3>
<input id="fUser" placeholder="Username">
<button class="login" onclick="recover()">Recover</button>
<div class="link" onclick="backAuth()">Back to Login</div>
<p id="fMsg"></p>
</div>

<!-- ICT PORTAL -->
<div class="card hidden" id="ict">
<h3>ICT Support Form</h3>
<input id="ictIssue" placeholder="Issue Description">
<input id="ictDevice" placeholder="Device / Serial Number">
<select id="ictStatus">
<option>Pending</option>
<option>Resolved</option>
</select>
<button class="download" onclick="savePortalData('ict')">Save Entry</button>
<button class="download" onclick="downloadPortalPDF('ict')">Download All Entries PDF</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<!-- LIBRARY PORTAL -->
<div class="card hidden" id="library">
<h3>Library Request Form</h3>
<input id="libTitle" placeholder="Book Title">
<input id="libAuthor" placeholder="Author">
<select id="libAction">
<option>Borrow</option>
<option>Return</option>
</select>
<button class="download" onclick="savePortalData('library')">Save Entry</button>
<button class="download" onclick="downloadPortalPDF('library')">Download All Entries PDF</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<!-- EXAM PORTAL -->
<div class="card hidden" id="exam">
<h3>Exam Request Form</h3>
<input id="examUnit" placeholder="Unit Name">
<select id="examType">
<option>Special Exam</option>
<option>Remark</option>
</select>
<button class="download" onclick="savePortalData('exam')">Save Entry</button>
<button class="download" onclick="downloadPortalPDF('exam')">Download All Entries PDF</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<!-- FINANCE PORTAL -->
<div class="card hidden" id="finance">
<h3>Finance Portal</h3>
<input id="fName" placeholder="Student Name">
<input id="fReg" placeholder="Registration Number">
<input id="fTotal" placeholder="Total Fees" value="50000">
<input id="fPaid" placeholder="Amount Paid" value="20000">
<p>Balance: <span id="fBalance">30000</span></p>
<button class="download" onclick="calcBalance()">Calculate Balance</button>

<h4>Payment History</h4>
<table id="fHistory">
<tr><th>Date</th><th>Receipt</th><th>Amount</th></tr>
<tr><td>10/01/2026</td><td>RC001</td><td>10,000</td></tr>
<tr><td>05/02/2026</td><td>RC002</td><td>10,000</td></tr>
</table>

<button class="download" onclick="downloadFeePDF()">Download Fee Statement PDF</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

</div>

<footer>
<p>Â© 2026 Msambweni Technical & Vocational College</p>
<p>Prepared by ICT Department | All Rights Reserved</p>
</footer>

<script>
const { jsPDF } = window.jspdf;

let portal='';
let users=JSON.parse(localStorage.getItem('portalUsers')||'{}');
let submissions=JSON.parse(localStorage.getItem('portalSubmissions')||'{}');

function openAuth(p){
  portal=p;
  portalSelect.classList.add("hidden");
  auth.classList.remove("hidden");
  authTitle.innerText=p.toUpperCase()+" PORTAL LOGIN";
  aUser.value=''; aPass.value=''; authMsg.innerText='';
}

function login(){
  if(users[portal]?.user===aUser.value && users[portal]?.pass===aPass.value){
    auth.classList.add("hidden");
    document.getElementById(portal).classList.remove("hidden");
  }else{
    authMsg.innerText="Invalid login";
  }
}

function showCreate(){ auth.classList.add("hidden"); create.classList.remove("hidden"); }
function showForgot(){ auth.classList.add("hidden"); forgot.classList.remove("hidden"); }
function backAuth(){ create.classList.add("hidden"); forgot.classList.add("hidden"); auth.classList.remove("hidden"); }

function createAccount(){
  users[portal]={user:cUser.value,pass:cPass.value};
  localStorage.setItem('portalUsers',JSON.stringify(users));
  alert("Account created for "+portal.toUpperCase());
  backAuth();
}

function recover(){ fMsg.innerText=users[portal]?("Password: "+users[portal].pass):"No account"; }

function logout(){
  document.querySelectorAll('.card').forEach(c=>c.classList.add("hidden"));
  portalSelect.classList.remove("hidden");
}

function savePortalData(p){
  if(!submissions[p]) submissions[p]=[];
  if(p==='ict'){
    submissions[p].push({Issue:ictIssue.value,Device:ictDevice.value,Status:ictStatus.value});
    ictIssue.value=''; ictDevice.value=''; ictStatus.value='Pending';
  }
  if(p==='library'){
    submissions[p].push({Book:libTitle.value,Author:libAuthor.value,Action:libAction.value});
    libTitle.value=''; libAuthor.value=''; libAction.value='Borrow';
  }
  if(p==='exam'){
    submissions[p].push({Unit:examUnit.value,Type:examType.value});
    examUnit.value=''; examType.value='Special Exam';
  }
  localStorage.setItem('portalSubmissions',JSON.stringify(submissions));
  alert("Entry saved successfully!");
}

// PDF with striped rows
function downloadPortalPDF(p){
  const doc=new jsPDF();
  doc.setFontSize(14);
  doc.setTextColor(13,71,161);
  doc.text("MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE",105,20,{align:"center"});
  doc.setFontSize(12);
  doc.text(p.toUpperCase()+" PORTAL SUBMISSIONS",105,30,{align:"center"});
  doc.text("Generated on: "+new Date().toLocaleString(),20,45);

  const data=submissions[p]||[];
  if(data.length===0){
    doc.text("No submissions yet.",20,60);
  }else{
    const keys=Object.keys(data[0]);
    const body=data.map((d,i)=>keys.map(k=>d[k]));
    doc.autoTable({
      startY:60,
      head:[keys],
      body:body,
      theme:'grid',
      headStyles:{fillColor:[13,71,161],textColor:255},
      styles:{cellPadding:4,fontSize:10},
      alternateRowStyles:{fillColor:[230,230,250]}
    });
  }
  doc.save(p+"_submissions.pdf");
}

// Finance portal functions
function calcBalance(){
  let total=Number(fTotal.value);
  let paid=Number(fPaid.value);
  fBalance.innerText=(total-paid).toLocaleString();
}

function downloadFeePDF(){
  const doc=new jsPDF();
  doc.setFontSize(14);
  doc.setTextColor(13,71,161);
  doc.text("MSAMBWENI TECHNICAL & VOCATIONAL COLLEGE",105,20,{align:"center"});
  doc.setFontSize(12);
  doc.text("FEE STATEMENT",105,30,{align:"center"});
  doc.text("Generated on: "+new Date().toLocaleString(),20,45);
  doc.text("Student Name: "+fName.value,20,55);
  doc.text("Registration No: "+fReg.value,20,63);

  // Fee summary
  doc.autoTable({
    startY:75,
    head:[["Total Fees","Paid","Balance"]],
    body:[[fTotal.value,fPaid.value,fBalance.innerText]],
    theme:'grid',
    headStyles:{fillColor:[13,71,161],textColor:255},
    styles:{cellPadding:4,fontSize:10},
    alternateRowStyles:{fillColor:[230,230,250]}
  });

  // Payment history
  let payData=[];
  const rows=document.querySelectorAll("#fHistory tr");
  for(let i=1;i<rows.length;i++){
    const cols=rows[i].querySelectorAll("td");
    payData.push([cols[0].innerText,cols[1].innerText,cols[2].innerText]);
  }

  doc.autoTable({
    startY:doc.lastAutoTable.finalY+10,
    head:[["Date","Receipt","Amount"]],
    body:payData,
    theme:'grid',
    headStyles:{fillColor:[13,71,161],textColor:255},
    styles:{cellPadding:4,fontSize:10},
    alternateRowStyles:{fillColor:[245,245,255]}
  });

  doc.text("Prepared by: Accounts Office",20,doc.lastAutoTable.finalY+15);
  doc.save("Fee_Statement.pdf");
}
</script>

</body>
</html>
