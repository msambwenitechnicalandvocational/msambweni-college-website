<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Msambweni TVC Portal</title>
<style>
:root{--blue:#0d47a1;--yellow:#fbc02d}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#f4f7fb}
header{background:linear-gradient(90deg,var(--blue),var(--yellow));color:#fff;padding:25px;text-align:center;position:relative}
header img{height:70px}
.container{max-width:1100px;margin:40px auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:25px}
.portal{background:#fff;border-radius:18px;padding:25px;text-align:center;box-shadow:0 14px 30px rgba(0,0,0,.25)}
.portal h2{color:var(--blue)}
.portal button{margin-top:15px;padding:10px 25px;border:none;border-radius:30px;color:#fff;font-weight:600;cursor:pointer}
.portal:nth-child(1) button{background:#fbc02d;color:#333}
.portal:nth-child(2) button{background:#1976d2}
.portal:nth-child(3) button{background:#2e7d32}
.portal:nth-child(4) button{background:#6a1b9a}
.portal:nth-child(5) button{background:#c62828}

.modal{display:none;position:fixed;inset:0;background:rgba(13,71,161,.85);display:flex;justify-content:center;align-items:center;z-index:10}
.box{background:#fff;padding:25px;border-radius:18px;width:90%;max-width:400px;text-align:center;}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc}
.full{width:100%;padding:12px;background:linear-gradient(90deg,var(--blue),var(--yellow));border:none;color:#fff;border-radius:25px;font-weight:600;cursor:pointer;margin-top:10px}
.link{text-align:center;color:var(--blue);cursor:pointer;font-size:13px;margin-top:8px;display:block}
.msg{font-size:13px;text-align:center;color:red;margin-top:5px}
.portal-content{display:none;max-width:900px;margin:20px auto;padding:20px;background:#fff;border-radius:15px;box-shadow:0 10px 20px rgba(0,0,0,.2)}
.logout{background:#9e9e9e;color:#fff;border:none;border-radius:10px;padding:10px 15px;cursor:pointer;margin-top:10px}
.portal-content h3{color:var(--blue)}
.portal-content table{width:100%;border-collapse:collapse;margin-top:10px}
.portal-content th, .portal-content td{border:1px solid #ccc;padding:8px;text-align:left}
.portal-content th{background:#1976d2;color:#fff}
.download-btn{background:var(--yellow);color:#333;padding:6px 12px;border:none;border-radius:8px;cursor:pointer;margin-top:5px}
</style>
</head>
<body>

<header>
<img src="files/msambweni-logo.png" alt="Logo">
<h1>Msambweni Technical & Vocational College</h1>
<p>Complete College Portal</p>
</header>

<div class="container" id="portalHome">
  <div class="portal"><h2>üìö Library Portal</h2><button onclick="showPortalLogin('library')">Enter</button></div>
  <div class="portal"><h2>üíª Masomo Portal</h2><button onclick="showPortalLogin('masomo')">Enter</button></div>
  <div class="portal"><h2>üí∞ Finance Portal</h2><button onclick="showPortalLogin('finance')">Enter</button></div>
  <div class="portal"><h2>üéì Student Portal</h2><button onclick="showPortalLogin('student')">Enter</button></div>
  <div class="portal"><h2>üßë‚Äçüíº Staff / Admin Portal</h2><button onclick="showPortalLogin('admin')">Enter</button></div>
</div>

<!-- Portal Authentication Modal -->
<div class="modal" id="authModal">
  <div class="box" id="loginBox">
    <h3 id="portalLoginTitle">Portal Login</h3>
    <input id="portalUser" placeholder="Username">
    <input id="portalPass" type="password" placeholder="Password">
    <button class="full" onclick="loginPortal()">Login</button>
    <div class="link" onclick="showRegister()">Create Account</div>
    <div class="link" onclick="showForgot()">Forgot Password?</div>
    <p class="msg" id="portalLoginMsg"></p>
  </div>

  <div class="box" id="registerBox" style="display:none">
    <h3>Create Account</h3>
    <input id="regName" placeholder="Full Name">
    <input id="regUser" placeholder="Username">
    <input id="regPass" type="password" placeholder="Password">
    <select id="regRole">
      <option value="student">Student</option>
      <option value="lecturer">Lecturer</option>
      <option value="finance">Finance</option>
      <option value="admin">Admin</option>
    </select>
    <button class="full" onclick="registerUser()">Register</button>
    <div class="link" onclick="showLogin()">Back to Login</div>
    <p class="msg" id="regMsg"></p>
  </div>

  <div class="box" id="forgotBox" style="display:none">
    <h3>Forgot Password</h3>
    <input id="fpUser" placeholder="Username">
    <button class="full" onclick="recoverPassword()">Recover</button>
    <div class="link" onclick="showLogin()">Back to Login</div>
    <p class="msg" id="fpMsg"></p>
  </div>
</div>

<!-- Portal Content -->
<div id="portalContent" class="portal-content">
  <h2 id="portalTitle"></h2>
  <div id="portalData"></div>
  <button class="logout" onclick="backHome()">Logout</button>
</div>

<script>
// Users storage
let users = JSON.parse(localStorage.getItem('users')||'[]');
if(users.length===0){
  users.push({name:'Admin User',user:'admin',pass:'admin123',role:'admin'});
  users.push({name:'Student User',user:'student1',pass:'pass123',role:'student'});
  users.push({name:'Finance User',user:'finance1',pass:'finance123',role:'finance'});
  users.push({name:'Lecturer User',user:'lecturer1',pass:'lec123',role:'lecturer'});
  localStorage.setItem('users',JSON.stringify(users));
}

const portalRoles = {
  'library':['student','lecturer','finance','admin'],
  'masomo':['student','lecturer'],
  'finance':['finance'],
  'student':['student'],
  'admin':['admin']
};

const libraryBooks = [
  {title:'Networking Basics',file:'files/networking.pdf'},
  {title:'Electronics 101',file:'files/electronics.pdf'}
];

const masomoNotes = [
  {title:'Math Assignment',file:'files/math.pdf'},
  {title:'ICT Notes',file:'files/ict.pdf'}
];

const financeData = [
  {student:'Student One',feeStatus:'Paid',receipt:'files/receipt1.pdf'},
  {student:'Student Two',feeStatus:'Pending',receipt:'files/receipt2.pdf'}
];

const studentResults = [
  {course:'ICT',score:'85'},
  {course:'Math',score:'78'}
];

let currentPortal = '';
let currentUser = null;

// Elements
const authModal = document.getElementById('authModal');
const loginBox = document.getElementById('loginBox');
const registerBox = document.getElementById('registerBox');
const forgotBox = document.getElementById('forgotBox');
const portalLoginMsg = document.getElementById('portalLoginMsg');
const regMsg = document.getElementById('regMsg');
const fpMsg = document.getElementById('fpMsg');

function showPortalLogin(portal){
  currentPortal = portal;
  authModal.style.display='flex';
  showLogin();
}

function showLogin(){ loginBox.style.display='block'; registerBox.style.display='none'; forgotBox.style.display='none'; portalLoginMsg.innerText=''; }
function showRegister(){ loginBox.style.display='none'; registerBox.style.display='block'; forgotBox.style.display='none'; regMsg.innerText=''; }
function showForgot(){ loginBox.style.display='none'; registerBox.style.display='none'; forgotBox.style.display='block'; fpMsg.innerText=''; }

function closeAuth(){ authModal.style.display='none'; }

function loginPortal(){
  const user = document.getElementById('portalUser').value;
  const pass = document.getElementById('portalPass').value;
  const u = users.find(x=>x.user===user && x.pass===pass);
  if(!u){ portalLoginMsg.innerText='Invalid username or password'; return;}
  if(!portalRoles[currentPortal].includes(u.role)){
    portalLoginMsg.innerText = `Access denied: ${u.role} cannot access ${currentPortal} portal`;
    return;
  }
  currentUser = u;
  closeAuth();
  openPortalContent(currentPortal);
}

function registerUser(){
  const name = document.getElementById('regName').value;
  const user = document.getElementById('regUser').value;
  const pass = document.getElementById('regPass').value;
  const role = document.getElementById('regRole').value;
  if(users.find(u=>u.user===user)){ regMsg.innerText='Username exists'; return;}
  users.push({name,user,pass,role});
  localStorage.setItem('users',JSON.stringify(users));
  regMsg.style.color='green';
  regMsg.innerText='Account created successfully';
}

function recoverPassword(){
  const user = document.getElementById('fpUser').value;
  const u = users.find(x=>x.user===user);
  if(!u){ fpMsg.innerText='User not found'; return;}
  fpMsg.style.color='green';
  fpMsg.innerText='Password: '+u.pass;
}

function openPortalContent(name){
  document.getElementById('portalHome').style.display='none';
  document.getElementById('portalContent').style.display='block';
  document.getElementById('portalTitle').innerText = name.toUpperCase()+' PORTAL';
  let data = `<p>Welcome <strong>${currentUser.name}</strong> (${currentUser.role})</p>`;
  if(name==='library'){
    data += '<h3>Books Available:</h3><ul>';
    libraryBooks.forEach(b=>data+=`<li>${b.title} <button class="download-btn" onclick="downloadFile('${b.file}')">Download PDF</button></li>`);
    data+='</ul>';
  } else if(name==='masomo'){
    data += '<h3>Notes & Assignments:</h3><ul>';
    masomoNotes.forEach(n=>data+=`<li>${n.title} <button class="download-btn" onclick="downloadFile('${n.file}')">Download PDF</button></li>`);
    data+='</ul>';
  } else if(name==='finance'){
    data += '<h3>Student Fees:</h3><table><tr><th>Student</th><th>Status</th><th>Receipt</th></tr>';
    financeData.forEach(f=>data+=`<tr><td>${f.student}</td><td>${f.feeStatus}</td><td><button class="download-btn" onclick="downloadFile('${f.receipt}')">Download</button></td></tr>`);
    data+='</table>';
  } else if(name==='student'){
    data += '<h3>Results:</h3><table><tr><th>Course</th><th>Score</th></tr>';
    studentResults.forEach(r=>data+=`<tr><td>${r.course}</td><td>${r.score}</td></tr>`);
    data+='</table>';
  } else if(name==='admin'){
    data += '<h3>Users:</h3><table><tr><th>Name</th><th>Username</th><th>Role</th></tr>';
    users.forEach(u=>data+=`<tr><td>${u.name}</td><td>${u.user}</td><td>${u.role}</td></tr>`);
    data+='</table>';
  }
  document.getElementById('portalData').innerHTML = data;
}

function backHome(){
  currentUser = null;
  document.getElementById('portalContent').style.display='none';
  document.getElementById('portalHome').style.display='grid';
}

function downloadFile(file){
  const a = document.createElement('a');
  a.href = file;
  a.download = file.split('/').pop();
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>

</body>
</html>
